# X推文追踪器

一个Chrome浏览器扩展插件，用于手动记录和保存X（Twitter）推文、回复和转推到本地存储。

## 功能特性

- ✅ **保存推文**：在X网页上直接点击"保存"按钮即可保存推文
- ✅ **支持多种类型**：支持保存推文、回复、转推（repost）和引用推文（quote）
- ✅ **完整信息**：保存推文文本、作者、日期、链接等完整信息
- ✅ **本地存储**：所有数据保存在浏览器本地，保护隐私
- ✅ **查看管理**：通过扩展popup界面查看、搜索和管理已保存的推文
- ✅ **数据导出**：支持导出所有保存的推文为JSON格式备份
- ✅ **动态检测**：自动检测页面中新加载的推文并添加保存按钮
- ✅ **悬浮刷新按钮**：网页右下角悬浮窗，一键刷新所有保存按钮
- ✅ **智能刷新**：支持在popup中刷新按钮，无需刷新整个网页

## 安装方法

### 从源码安装（开发模式）

1. 下载或克隆本项目到本地
2. 打开Chrome浏览器，进入扩展管理页面：
   - 方法1：在地址栏输入 `chrome://extensions/`
   - 方法2：点击右上角三点菜单 → 更多工具 → 扩展程序
3. 开启右上角的"开发者模式"
4. 点击"加载已解压的扩展程序"
5. 选择本项目的文件夹（包含 `manifest.json` 的目录）
6. 扩展安装完成！

## 部署指南

### 方式一：打包为 .crx 文件（本地分发）

1. **准备扩展文件**
   ```bash
   # 确保所有文件都在项目目录中
   ls -la
   ```

2. **在Chrome中打包扩展**
   - 打开 `chrome://extensions/`
   - 确保"开发者模式"已开启
   - 点击"打包扩展程序"
   - 选择扩展程序根目录（项目文件夹）
   - 可选：选择私钥文件（如果之前打包过）
   - 点击"打包扩展程序"
   - 会生成 `.crx` 文件和 `.pem` 私钥文件

3. **安装打包的扩展**
   - 将 `.crx` 文件拖拽到 `chrome://extensions/` 页面
   - 或使用命令行安装（需要先启用开发者模式）

**注意**：`.pem` 文件是私钥，用于后续更新，请妥善保管！

### 方式二：发布到 Chrome Web Store（推荐）

#### 准备工作

1. **创建开发者账号**
   - 访问 [Chrome Web Store 开发者控制台](https://chrome.google.com/webstore/devconsole)
   - 支付一次性注册费用（$5 USD）
   - 完成开发者账号注册

2. **准备发布材料**
   - 扩展图标（已包含在 `icons/` 目录）
   - 应用截图（至少1张，建议1280x800或640x400）
   - 详细描述（中英文）
   - 隐私政策（如果收集用户数据）

3. **打包扩展**
   ```bash
   # 确保项目目录结构正确
   # 所有必需文件都已包含
   ```

#### 发布步骤

1. **打包扩展程序**
   - 在 `chrome://extensions/` 中点击"打包扩展程序"
   - 生成 `.zip` 文件（不要包含 `.pem` 文件）
   - 或者手动创建zip文件：
   ```bash
   # 在项目根目录执行
   zip -r x-tracker.zip . -x "*.git*" -x "*.pem" -x "*.md" -x ".DS_Store"
   ```

2. **上传到 Chrome Web Store**
   - 登录 [Chrome Web Store 开发者控制台](https://chrome.google.com/webstore/devconsole)
   - 点击"新建项目"
   - 上传 `.zip` 文件
   - 填写商店信息：
     - **名称**：X推文追踪器
     - **简短描述**：手动记录和保存X推文到本地
     - **详细描述**：见下方模板
     - **类别**：生产力工具
     - **语言**：中文（简体）
     - **图标**：上传 128x128 图标
     - **截图**：至少1张应用截图
     - **隐私政策**：如果收集数据需要提供链接

3. **填写商店信息模板**

   **简短描述**：
   ```
   手动记录和保存X（Twitter）推文、回复、转推和引用推文到本地存储
   ```

   **详细描述**：
   ```
   X推文追踪器是一个Chrome浏览器扩展，帮助您轻松保存和管理X（Twitter）上的重要推文。

   主要功能：
   • 一键保存推文：在X网页上直接点击"保存"按钮即可保存推文
   • 支持多种类型：支持保存推文、回复、转推和引用推文
   • 完整信息保存：保存推文文本、作者、日期、链接等完整信息
   • 本地存储：所有数据保存在浏览器本地，保护您的隐私
   • 便捷管理：通过扩展界面查看、筛选、导出和删除已保存的推文
   • 数据导出：支持导出所有保存的推文为JSON格式备份

   隐私保护：
   • 所有数据仅存储在您的浏览器本地
   • 不会上传任何数据到服务器
   • 不会收集任何个人信息

   使用方法：
   1. 在X.com或Twitter.com上浏览推文
   2. 点击推文旁的"保存"按钮
   3. 点击扩展图标查看已保存的推文
   ```

4. **提交审核**
   - 检查所有信息填写完整
   - 点击"提交审核"
   - 等待Google审核（通常1-3个工作日）

5. **审核通过后**
   - 扩展会自动发布到Chrome Web Store
   - 用户可以通过商店搜索安装
   - 您可以在开发者控制台查看下载统计

#### 更新扩展

1. 修改 `manifest.json` 中的版本号
2. 重新打包为 `.zip` 文件
3. 在开发者控制台选择已发布的扩展
4. 点击"上传新的程序包"
5. 填写更新说明
6. 提交审核

### 方式三：使用 GitHub Releases（技术用户）

1. **创建 Release**
   - 在GitHub仓库中创建新的Release
   - 上传打包好的 `.zip` 或 `.crx` 文件
   - 添加版本说明

2. **用户安装**
   - 下载 `.crx` 文件
   - 拖拽到 `chrome://extensions/` 页面安装
   - 或下载源码，使用"加载已解压的扩展程序"

### 打包脚本

创建一个简单的打包脚本 `package.sh`：

```bash
#!/bin/bash
# 打包扩展为zip文件（用于Chrome Web Store）

VERSION=$(grep '"version"' manifest.json | cut -d'"' -f4)
OUTPUT="x-tracker-v${VERSION}.zip"

# 创建临时目录
mkdir -p dist

# 复制文件（排除不需要的文件）
cp manifest.json dist/
cp *.js dist/
cp *.css dist/
cp *.html dist/
cp -r icons dist/

# 打包
cd dist
zip -r "../${OUTPUT}" .
cd ..

# 清理
rm -rf dist

echo "打包完成: ${OUTPUT}"
```

使用方法：
```bash
chmod +x package.sh
./package.sh
```

### 版本管理建议

在 `manifest.json` 中遵循语义化版本：
- **主版本号**：不兼容的API修改
- **次版本号**：向下兼容的功能性新增
- **修订号**：向下兼容的问题修正

示例：`1.0.0` → `1.1.0` → `1.1.1` → `2.0.0`

## 使用方法

### 保存推文

1. 打开 [X.com](https://x.com) 或 [Twitter.com](https://twitter.com)
2. 浏览推文时，每条推文旁边会出现一个"保存"按钮
3. 点击"保存"按钮即可保存该推文
4. 保存成功后，按钮会变为"已保存"状态

### 查看已保存的推文

1. 点击浏览器工具栏中的扩展图标
2. 在popup窗口中查看所有已保存的推文
3. 可以按类型筛选（全部/推文/回复/转推/引用）
4. 点击推文可以打开原始推文链接
5. 可以复制链接或删除已保存的推文

### 刷新保存按钮

如果保存按钮没有显示或消失，有两种方式刷新：

1. **使用悬浮窗刷新**（推荐）：
   - 在X网页右下角会显示一个蓝色圆形刷新按钮
   - 点击该按钮即可刷新所有保存按钮
   - 刷新时会显示加载动画和提示消息

2. **使用popup刷新**：
   - 点击扩展图标打开popup窗口
   - 点击右上角的刷新按钮（圆形箭头图标）
   - 所有X网页标签页的保存按钮都会刷新

### 导出数据

1. 在popup窗口中点击右上角的导出按钮
2. 选择保存位置
3. 数据将以JSON格式导出，包含所有推文信息

### 清空数据

1. 在popup窗口中点击右上角的清空按钮
2. 确认后即可清空所有已保存的推文

## 项目结构

```
X_tracker/
├── manifest.json          # 扩展配置文件（包含固定扩展ID）
├── content.js            # 内容脚本（注入到X网页，处理推文提取和按钮添加）
├── content.css           # 内容脚本样式（保存按钮和悬浮窗样式）
├── background.js         # 后台服务工作者（处理消息传递和存储操作）
├── storage.js            # 存储管理模块（封装Chrome Storage操作）
├── popup.html            # Popup界面HTML
├── popup.css             # Popup界面样式
├── popup.js              # Popup界面逻辑（显示和管理已保存的推文）
├── icons/                # 扩展图标
│   ├── tagged_bookmark 16px.png
│   ├── tagged_bookmark 48px.png
│   └── tagged_bookmark 128px.png
└── README.md             # 说明文档
```

## 技术实现

- **Manifest V3**：使用最新的Chrome扩展API
- **Content Script**：注入到X网页，提取推文信息并添加保存按钮
- **MutationObserver**：监听DOM变化，自动为新加载的推文添加保存按钮
- **Chrome Storage API**：使用 `chrome.storage.local` 本地存储数据
- **消息传递**：Content Script、Popup和Background Service Worker之间通过消息传递通信
- **悬浮窗**：使用固定定位在网页右下角显示刷新按钮
- **事件监听**：监听`popstate`和`pageshow`事件，处理浏览器前进/后退时的按钮刷新
- **响应式设计**：popup界面适配不同屏幕尺寸

## 数据格式

保存的推文数据格式如下：

```json
{
  "tweetId": {
    "id": "推文ID",
    "text": "推文文本内容",
    "author": {
      "name": "作者名称",
      "handle": "作者用户名"
    },
    "date": "ISO日期格式",
    "dateText": "显示的日期文本",
    "link": "推文链接",
    "type": "tweet|reply|repost|quote",
    "originalAuthor": "原始作者（如果是转推）",
    "quotedTweet": {
      "text": "被引用的推文文本（如果是引用推文）",
      "author": {
        "name": "被引用推文的作者名称",
        "handle": "被引用推文的作者用户名"
      },
      "link": "被引用推文的链接"
    },
    "hasMedia": true/false,
    "savedAt": "保存时间（ISO格式）"
  }
}
```

## 存储方案

### 存储方式

扩展使用 **Chrome Storage Local API** 作为存储方案：

- **存储类型**：`chrome.storage.local`
- **容量限制**：10MB
- **数据持久性**：使用固定的扩展ID（通过manifest.json中的key字段），确保重新安装扩展后数据不丢失
- **性能**：适合存储大量推文数据（通常可存储数千条推文）

### 存储限制

- **容量**：10MB（Chrome Storage Local的限制）
- **实际容量**：根据推文长度，通常可存储数千到上万条推文
- **监控**：在popup界面中会显示当前存储使用量，方便监控

### 数据持久性

扩展使用固定的扩展ID（通过manifest.json中的`key`字段），确保：
- 重新安装扩展后数据不会丢失
- 扩展ID保持一致，存储数据可以正常访问
- 开发模式下数据也能持久保存

### 存储使用量

在popup界面中会显示：
- 存储状态（Chrome Storage）
- 当前存储使用量（字节/KB/MB）
- 存储使用百分比

## 注意事项

1. **数据存储**：所有数据存储在浏览器本地，清除浏览器数据会丢失保存的推文
2. **定期备份**：建议定期使用导出功能备份数据
3. **存储容量**：Chrome Storage Local有10MB限制，通常可存储数千条推文，建议定期导出备份
4. **X网站更新**：如果X网站更新了DOM结构，可能需要更新选择器
5. **隐私保护**：所有数据仅存储在本地，不会上传到任何服务器
6. **扩展ID**：扩展使用固定的扩展ID（通过manifest.json中的key字段），确保重新安装后数据不丢失
7. **悬浮窗**：悬浮窗固定在右下角，不会影响正常浏览，可以随时点击刷新保存按钮

## 开发说明

### 修改推文选择器

如果X网站更新导致无法识别推文，需要修改 `content.js` 中的选择器：

- 推文容器：`article[data-testid="tweet"]`
- 推文文本：`[data-testid="tweetText"]`
- 作者信息：`[data-testid="User-Name"]`
- 时间戳：`time`
- 推文链接：`a[href*="/status/"]`

### 调试方法

1. 在扩展管理页面点击"检查视图" → "service worker" 查看后台日志
2. 在X网页上按F12打开开发者工具，查看Console中的日志
3. 在popup界面按F12查看popup的调试信息

## 许可证

MIT License

## 更新日志

### v1.0.0 (2024)
- 初始版本发布
- 支持保存推文、回复和转推
- 支持查看、导出和删除已保存的推文
- 支持按类型筛选推文
- 支持引用推文（quote tweet）的保存
- 使用Chrome Storage Local作为存储方案
- 添加固定扩展ID，确保重新安装后数据不丢失
- 添加悬浮刷新按钮（网页右下角）
- 添加popup刷新按钮功能
- 支持浏览器前进/后退时自动刷新保存按钮
- 优化保存按钮的显示逻辑，防止重复按钮
- 改进推文信息提取，支持更完整的引用推文信息

